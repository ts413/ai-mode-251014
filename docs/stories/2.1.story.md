# Story 2.1: λ…ΈνΈ μƒμ„± (μ λ© + λ³Έλ¬Έ)

## Status

Done

## Story

**As a** λ΅κ·ΈμΈν• μ‚¬μ©μ,
**I want** μ λ©κ³Ό λ³Έλ¬Έμ΄ μλ” μƒλ΅μ΄ λ…ΈνΈλ¥Ό μƒμ„±ν•  μ μλ” κΈ°λ¥,
**so that** λ‚΄ μƒκ°κ³Ό μ •λ³΄λ¥Ό μ²΄κ³„μ μΌλ΅ κΈ°λ΅ν•κ³  μ €μ¥ν•  μ μλ‹¤.

## Acceptance Criteria

1. λ€μ‹λ³΄λ“μ—μ„ "μƒ λ…ΈνΈ μ‘μ„±" λ²„νΌμ„ ν†µν•΄ λ…ΈνΈ μ‘μ„± νμ΄μ§€μ— μ ‘κ·Όν•  μ μμ–΄μ•Ό ν•λ‹¤
2. λ…ΈνΈ μ λ©μ„ μ…λ ¥ν•  μ μλ” ν…μ¤νΈ ν•„λ“κ°€ μ κ³µλμ–΄μ•Ό ν•λ‹¤
3. λ…ΈνΈ λ³Έλ¬Έμ„ μ…λ ¥ν•  μ μλ” ν…μ¤νΈ μ—λ¦¬μ–΄κ°€ μ κ³µλμ–΄μ•Ό ν•λ‹¤
4. λ…ΈνΈ μ €μ¥ λ²„νΌμ„ ν΄λ¦­ν•λ©΄ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λμ–΄μ•Ό ν•λ‹¤
5. μ €μ¥ μ„±κ³µ μ‹ λ…ΈνΈ λ©λ΅ νμ΄μ§€λ΅ λ¦¬λ‹¤μ΄λ ‰νΈλμ–΄μ•Ό ν•λ‹¤
6. μ λ©μ΄ λΉ„μ–΄μμ„ κ²½μ° "μ λ© μ—†μ" κΈ°λ³Έκ°’μ΄ μ„¤μ •λμ–΄μ•Ό ν•λ‹¤
7. λ³Έλ¬Έμ΄ λΉ„μ–΄μμ–΄λ„ λ…ΈνΈ μƒμ„±μ΄ κ°€λ¥ν•΄μ•Ό ν•λ‹¤
8. μ €μ¥ μ¤‘ λ΅λ”© μƒνƒκ°€ ν‘μ‹λμ–΄μ•Ό ν•λ‹¤
9. μ €μ¥ μ‹¤ν¨ μ‹ μ μ ν• μ—λ¬ λ©”μ‹μ§€κ°€ ν‘μ‹λμ–΄μ•Ό ν•λ‹¤

## Tasks / Subtasks

-   [x] Drizzle ORM μ„¤μΉ λ° μ„¤μ • (κΈ°λ° μ‘μ—…)
    -   [x] Drizzle ORM λ° κ΄€λ ¨ ν¨ν‚¤μ§€ μ„¤μΉ
    -   [x] Drizzle μ„¤μ • νμΌ κµ¬μ„± (`drizzle.config.ts`)
    -   [x] ν™κ²½ λ³€μ μ„¤μ • (`DATABASE_URL`)
    -   [x] κ°λ° ν™κ²½ μ¤ν¬λ¦½νΈ μ„¤μ •
-   [x] λ…ΈνΈ λ°μ΄ν„° λ¨λΈ μ„¤κ³„ λ° κµ¬ν„ (AC: 4)
    -   [x] Drizzle μ¤ν‚¤λ§ νμΌ μƒμ„± (`lib/db/schema/notes.ts`)
    -   [x] λ…ΈνΈ ν…μ΄λΈ” μ¤ν‚¤λ§ μ •μ (PostgreSQL)
    -   [x] κ΄€κ³„ν• λ°μ΄ν„° λ° μΈλ±μ¤ μ •μ
    -   [x] TypeScript νƒ€μ… μλ™ μƒμ„± μ„¤μ •
-   [x] λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ… (AC: 4)
    -   [x] Drizzle λ§μ΄κ·Έλ μ΄μ… νμΌ μƒμ„±
    -   [x] Supabaseμ— λ§μ΄κ·Έλ μ΄μ… μ μ©
    -   [x] RLS μ •μ±… μ„¤μ • (μ‚¬μ©μλ³„ μ ‘κ·Ό μ μ–΄)
    -   [x] λ§μ΄κ·Έλ μ΄μ… κ²€μ¦ λ° ν…μ¤νΈ
-   [x] λ…ΈνΈ μ‘μ„± νμ΄μ§€ κµ¬ν„ (AC: 1, 2, 3, 8)
    -   [x] `/notes/new` λΌμ°νΈ μƒμ„±
    -   [x] λ…ΈνΈ μ‘μ„± νΌ μ»΄ν¬λ„νΈ κµ¬ν„
    -   [x] μ λ© μ…λ ¥ ν•„λ“ (Input μ»΄ν¬λ„νΈ)
    -   [x] λ³Έλ¬Έ μ…λ ¥ μ—λ¦¬μ–΄ (Textarea μ»΄ν¬λ„νΈ)
    -   [x] μ €μ¥/μ·¨μ† λ²„νΌ UI
-   [x] λ…ΈνΈ μ €μ¥ λ΅μ§ κµ¬ν„ (AC: 4, 5, 6, 7, 9)
    -   [x] λ…ΈνΈ μƒμ„± Server Action κµ¬ν„
    -   [x] ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ νΌ μ μ¶ μ²λ¦¬
    -   [x] μ λ© κΈ°λ³Έκ°’ μ²λ¦¬ λ΅μ§
    -   [x] μ—λ¬ ν•Έλ“¤λ§ λ° μ‚¬μ©μ ν”Όλ“λ°±
    -   [x] μ„±κ³µ μ‹ λ¦¬λ‹¤μ΄λ ‰νΈ μ²λ¦¬
-   [x] λ€μ‹λ³΄λ“ μ—°λ™ (AC: 1)
    -   [x] λ€μ‹λ³΄λ“μ— "μƒ λ…ΈνΈ μ‘μ„±" CTA λ²„νΌ μ¶”κ°€
    -   [x] λ…ΈνΈ μ‘μ„± νμ΄μ§€λ΅ λ„¤λΉ„κ²μ΄μ… μ—°κ²°

## Dev Notes

### μ΄μ „ μ¤ν† λ¦¬ μΈμ‚¬μ΄νΈ

[Source: Story 1.1, 1.2, 1.3 Dev Agent Records]

-   β… Supabase μΈν”„λΌ λ° ν™κ²½ λ³€μ μ„¤μ • μ™„λ£
-   β… Next.js Server Actions ν¨ν„΄ ν™•λ¦½
-   β… shadcn/ui μ»΄ν¬λ„νΈ μ‹μ¤ν… ν™μ© κ²½ν—
-   β… μ‚¬μ©μ μΈμ¦ λ° κ¶ν• μ μ–΄ κµ¬ν„ μ™„λ£

### κΈ°μ  μ¤νƒ μ •λ³΄

[Source: docs/architecture.md#1-κΈ°μ -μ¤νƒ]

-   **ν”„λ μ„μ›ν¬:** Next.js (App Router, Server Actions)
-   **UI:** shadcn/ui + Tailwind + Radix UI
-   **DB/μΈμ¦:** Supabase (Postgres, Auth, Storage)

### λ³΄μ• μ”κµ¬μ‚¬ν•­

[Source: docs/architecture.md#3-λ³΄μ•]

-   Supabase μ„λΉ„μ¤ λ΅¤ ν‚¤λ” μ„λ²„ μ „μ©μΌλ΅ μ‚¬μ©
-   μ‚¬μ©μ ID μ¤μ½”ν”„λ΅ κ¶ν• μ μ–΄ (RLS μ •μ±…)

### Drizzle ORM μ„¤μ •

**ν•„μ”ν• ν¨ν‚¤μ§€**:

```bash
pnpm add drizzle-orm postgres dotenv
pnpm add -D drizzle-kit tsx
```

**Drizzle μ„¤μ • νμΌ** (`drizzle.config.ts`):

```typescript
import 'dotenv/config'
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
    out: './drizzle',
    schema: './lib/db/schema/*.ts',
    dialect: 'postgresql',
    dbCredentials: {
        url: process.env.DATABASE_URL!
    }
})
```

**ν™κ²½ λ³€μ μ¶”κ°€** (`.env.local`):

```env
# Drizzle ORMμ© λ°μ΄ν„°λ² μ΄μ¤ URL
DATABASE_URL="postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres"
```

**Package.json μ¤ν¬λ¦½νΈ μ¶”κ°€**:

```json
{
    "scripts": {
        "db:generate": "drizzle-kit generate",
        "db:migrate": "drizzle-kit migrate",
        "db:push": "drizzle-kit push",
        "db:studio": "drizzle-kit studio"
    }
}
```

### λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§

**Drizzle μ¤ν‚¤λ§ μ •μ** (`lib/db/schema/notes.ts`):

```typescript
import { pgTable, uuid, text, timestamp } from 'drizzle-orm/pg-core'
import { createInsertSchema, createSelectSchema } from 'drizzle-zod'

export const notes = pgTable('notes', {
    id: uuid('id').defaultRandom().primaryKey(),
    userId: uuid('user_id').notNull(),
    title: text('title').notNull().default('μ λ© μ—†μ'),
    content: text('content'),
    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),
    updatedAt: timestamp('updated_at', { withTimezone: true }).defaultNow()
})

// Zod μ¤ν‚¤λ§ μλ™ μƒμ„±
export const insertNoteSchema = createInsertSchema(notes)
export const selectNoteSchema = createSelectSchema(notes)

export type Note = typeof notes.$inferSelect
export type NewNote = typeof notes.$inferInsert
```

**RLS μ •μ±…** (Supabaseμ—μ„ λ³„λ„ μ μ©):

```sql
-- RLS ν™μ„±ν™”
ALTER TABLE public.notes ENABLE ROW LEVEL SECURITY;

-- μ •μ±… μƒμ„±
CREATE POLICY "Users can view own notes" ON public.notes
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can create own notes" ON public.notes
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own notes" ON public.notes
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own notes" ON public.notes
  FOR DELETE USING (auth.uid() = user_id);
```

### ν”„λ΅μ νΈ κµ¬μ΅°

**Drizzle ORM κµ¬μ΅°**:

-   Drizzle μ„¤μ •: `drizzle.config.ts`
-   DB μ—°κ²°: `lib/db/connection.ts`
-   μ¤ν‚¤λ§ μ •μ: `lib/db/schema/notes.ts`
-   λ§μ΄κ·Έλ μ΄μ…: `drizzle/`

**λ…ΈνΈ κ΄€λ¦¬**:

-   λ…ΈνΈ μƒμ„± νμ΄μ§€: `app/notes/new/page.tsx`
-   λ…ΈνΈ μ‘μ„± μ»΄ν¬λ„νΈ: `components/notes/note-form.tsx`
-   λ…ΈνΈ μ„λ²„ μ•΅μ…: `lib/notes/actions.ts`
-   λ…ΈνΈ DB μΏΌλ¦¬: `lib/notes/queries.ts`

### ν™κ²½ λ³€μ μ”κµ¬μ‚¬ν•­

[Source: Story 1.1, 1.2, 1.3 - μ΄λ―Έ μ„¤μ • μ™„λ£]

-   β… `NEXT_PUBLIC_SUPABASE_URL`
-   β… `NEXT_PUBLIC_SUPABASE_ANON_KEY`
-   β… `SUPABASE_SERVICE_ROLE_KEY`

**μƒλ΅ μ¶”κ°€ ν•„μ”**:

-   π†• `DATABASE_URL` - Drizzle ORMμ© μ§μ ‘ DB μ—°κ²°

### μ¬μ‚¬μ© κ°€λ¥ν• μ»΄ν¬λ„νΈ

-   `components/ui/button.tsx` - μ €μ¥/μ·¨μ† λ²„νΌ
-   `components/ui/input.tsx` - μ λ© μ…λ ¥ ν•„λ“
-   `components/ui/textarea.tsx` - λ³Έλ¬Έ μ…λ ¥ μ—λ¦¬μ–΄ (μƒλ΅ μ¶”κ°€ ν•„μ”)
-   `components/ui/label.tsx` - νΌ λ μ΄λΈ”
-   `components/ui/card.tsx` - λ…ΈνΈ νΌ μ»¨ν…μ΄λ„

### UX/UI κ³ λ ¤μ‚¬ν•­

-   **λ¨λ°”μΌ λ°μ‘ν•**: μ‘μ€ ν™”λ©΄μ—μ„λ„ νΈλ¦¬ν• λ…ΈνΈ μ‘μ„±
-   **μ ‘κ·Όμ„±**: ν‚¤λ³΄λ“ λ„¤λΉ„κ²μ΄μ… λ° μ¤ν¬λ¦° λ¦¬λ” μ§€μ›
-   **μλ™ ν¬μ»¤μ¤**: νμ΄μ§€ λ΅λ“ μ‹ μ λ© ν•„λ“μ— μλ™ ν¬μ»¤μ¤
-   **μ €μ¥ ν”Όλ“λ°±**: λ΅λ”© μ¤ν”Όλ„ λ° μ„±κ³µ/μ‹¤ν¨ λ©”μ‹μ§€

### Testing

#### ν…μ¤νΈ ν‘μ¤€

[Source: docs/architecture.md#6-λ°°ν¬μ΄μ]

-   ν…μ¤νΈ ν”„λ μ„μ›ν¬: Jest + React Testing Library (μ¶”μ •)
-   ν…μ¤νΈ νμΌ μ„μΉ: `__tests__/` λλ” μ»΄ν¬λ„νΈ μ†μ— `.test.tsx`

#### λ…ΈνΈ μƒμ„± ν…μ¤νΈ

-   λ…ΈνΈ νΌ λ λ”λ§ ν…μ¤νΈ
-   μ λ©/λ³Έλ¬Έ μ…λ ¥ ν…μ¤νΈ
-   νΌ μ μ¶ λ° μ €μ¥ ν…μ¤νΈ
-   μ—λ¬ ν•Έλ“¤λ§ ν…μ¤νΈ
-   λ¦¬λ‹¤μ΄λ ‰νΈ λ™μ‘ ν…μ¤νΈ

## Change Log

| Date       | Version | Description | Author           |
| ---------- | ------- | ----------- | ---------------- |
| 2025-09-13 | 1.0     | μ¤ν† λ¦¬ μƒμ„± | Scrum Master Bob |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (Cursor ν™κ²½)

### Debug Log References

1. **Drizzle Zod μ¤ν‚¤λ§ μ¤λ¥ ν•΄κ²°**

    - μ¤λ¥: `'ZodString' ν•μ‹μ— 'title' μ†μ„±μ΄ μ—†μµλ‹λ‹¤.`
    - ν•΄κ²°: `createInsertSchema` μ½λ°± νλΌλ―Έν„° μμ • (`schema => schema.title` β†’ `z => z`)

2. **Server Action redirect μ¤λ¥ ν•΄κ²°**

    - μ¤λ¥: `NEXT_REDIRECT` μμ™Έκ°€ try-catchμ—μ„ μ΅ν
    - ν•΄κ²°: `redirect()` νΈμ¶μ„ try-catch λΈ”λ΅ λ°–μΌλ΅ μ΄λ™

3. **κ°•μμ© λ§μ΄κ·Έλ μ΄μ… κ΄€λ¦¬ λ°©μ‹ μ„¤μ •**
    - λ¬Έμ : μκ°•μƒ ν™κ²½μ—μ„ λ§μ΄κ·Έλ μ΄μ… νμΌκ³Ό λ©”νƒ€λ°μ΄ν„° μ¶©λ
    - ν•΄κ²°: `drizzle/` μ „μ²΄λ¥Ό `.gitignore`μ— μ¶”κ°€, `db:generate` β†’ `db:migrate` μ›ν¬ν”λ΅μ° μ μ©

### Completion Notes List

1. β… **Drizzle ORM μ™„μ „ μ„¤μ •**

    - ν¨ν‚¤μ§€ μ„¤μΉ: `drizzle-orm`, `postgres`, `drizzle-kit`, `drizzle-zod`
    - μ„¤μ • νμΌ: `drizzle.config.ts` with dotenv λ΅λ”©
    - ν™κ²½ λ³€μ: `DATABASE_URL` μ¶”κ°€

2. β… **λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ κµ¬ν„**

    - `notes` ν…μ΄λΈ”: id, user_id, title, content, created_at, updated_at
    - Zod μ¤ν‚¤λ§ μλ™ μƒμ„± λ° μ ν¨μ„± κ²€μ¦
    - RLS μ •μ±… SQL μ¤ν¬λ¦½νΈ μƒμ„±

3. β… **UI μ»΄ν¬λ„νΈ κµ¬ν„**

    - `Textarea` μ»΄ν¬λ„νΈ μ¶”κ°€ (shadcn/ui μ¤νƒ€μΌ)
    - `NoteForm` μ»΄ν¬λ„νΈ: νΌ μ μ¶, λ΅λ”© μƒνƒ, μ—λ¬ ν•Έλ“¤λ§
    - μλ™ ν¬μ»¤μ¤, μµλ€ κΈΈμ΄ μ ν•, μ‚¬μ©μ ν”Όλ“λ°±

4. β… **Server Actions κµ¬ν„**

    - `createNote`: μ ν¨μ„± κ²€μ¦, λ°μ΄ν„°λ² μ΄μ¤ μ €μ¥, λ¦¬λ‹¤μ΄λ ‰νΈ
    - `getUserNotes`, `getNoteById`: μ‚¬μ©μλ³„ λ…ΈνΈ μ΅°ν
    - μ‚¬μ©μ μΈμ¦ λ° κ¶ν• ν™•μΈ

5. β… **λΌμ°ν… λ° λ„¤λΉ„κ²μ΄μ…**

    - `/notes/new`: λ…ΈνΈ μ‘μ„± νμ΄μ§€
    - `/notes`: λ…ΈνΈ λ©λ΅ νμ΄μ§€ (λΉ μƒνƒ ν¬ν•¨)
    - λ€μ‹λ³΄λ“μ—μ„ λ…ΈνΈ μ‘μ„± νμ΄μ§€λ΅ λ§ν¬ μ—°κ²°

6. β… **κ°•μμ© ν™κ²½ μ„¤μ •**
    - `.env.example` μ—…λ°μ΄νΈ with `DATABASE_URL`
    - README.mdμ— μƒμ„Έν• μ„¤μ • κ°€μ΄λ“ μ¶”κ°€
    - λ§μ΄κ·Έλ μ΄μ… μ¶©λ ν•΄κ²° λ°©μ• λ¬Έμ„ν™”

### File List

**μƒλ΅ μƒμ„±λ νμΌ:**

-   `drizzle.config.ts` - Drizzle ORM μ„¤μ •
-   `lib/db/connection.ts` - λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²°
-   `lib/db/schema/notes.ts` - λ…ΈνΈ ν…μ΄λΈ” μ¤ν‚¤λ§
-   `lib/notes/actions.ts` - λ…ΈνΈ κ΄€λ ¨ Server Actions
-   `lib/notes/queries.ts` - λ…ΈνΈ μ΅°ν ν•¨μλ“¤
-   `components/ui/textarea.tsx` - ν…μ¤νΈμ—λ¦¬μ–΄ UI μ»΄ν¬λ„νΈ
-   `components/notes/note-form.tsx` - λ…ΈνΈ μ‘μ„± νΌ μ»΄ν¬λ„νΈ
-   `app/notes/new/page.tsx` - λ…ΈνΈ μ‘μ„± νμ΄μ§€
-   `app/notes/page.tsx` - λ…ΈνΈ λ©λ΅ νμ΄μ§€
-   `supabase/migrations/0001_enable_rls_and_policies.sql` - RLS μ •μ±… SQL

**μμ •λ νμΌ:**

-   `package.json` - Drizzle κ΄€λ ¨ μ¤ν¬λ¦½νΈ λ° μμ΅΄μ„± μ¶”κ°€
-   `.env.local` - `DATABASE_URL` μ¶”κ°€
-   `.env.example` - ν™κ²½ λ³€μ κ°€μ΄λ“ μ—…λ°μ΄νΈ
-   `.gitignore` - `drizzle/` ν΄λ” μ μ™Έ
-   `README.md` - ν”„λ΅μ νΈ μ„¤μ • κ°€μ΄λ“ μ¶”κ°€
-   `app/page.tsx` - λ…ΈνΈ μ‘μ„± λ§ν¬ μ¶”κ°€

## QA Results

QA μ—μ΄μ „νΈκ°€ μ™„λ£λ μ¤ν† λ¦¬ κµ¬ν„μ„ κ²€ν† ν• κ²°κ³Όμ…λ‹λ‹¤.
