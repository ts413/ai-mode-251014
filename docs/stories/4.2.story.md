# Story 4.2: λ…ΈνΈ λ‚΄μ© κΈ°λ° μλ™ μ”μ•½ μƒμ„±

## π“‹ κΈ°λ³Έ μ •λ³΄

- **Epic:** 4 - AI κΈ°λ° μ”μ•½ λ° νƒκΉ…
- **Story ID:** 4.2
- **Title:** λ…ΈνΈ λ‚΄μ© κΈ°λ° μλ™ μ”μ•½ μƒμ„±
- **Status:** Ready for Review
- **Story Points:** 3
- **Priority:** P1 (High)

## π“– Story

**As a** μ‚¬μ©μ  
**I want to** λ…ΈνΈλ¥Ό μ €μ¥ν•  λ• AIκ°€ μλ™μΌλ΅ μ”μ•½μ„ μƒμ„±ν•μ—¬  
**So that** κΈ΄ λ…ΈνΈμ ν•µμ‹¬ λ‚΄μ©μ„ λΉ λ¥΄κ² νμ•…ν•  μ μλ‹¤

## β… Acceptance Criteria

1. **μλ™ μ”μ•½ μƒμ„±**: λ…ΈνΈ μ €μ¥ μ‹ 3-6κ°μ λ¶λ¦Ώ ν¬μΈνΈλ΅ κµ¬μ„±λ μ”μ•½ μλ™ μƒμ„±
2. **μ”μ•½ μ €μ¥**: μƒμ„±λ μ”μ•½μ„ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥
3. **μ”μ•½ ν‘μ‹**: λ…ΈνΈ μƒμ„Έ νμ΄μ§€μ—μ„ μ”μ•½ λ‚΄μ© ν‘μ‹
4. **μ”μ•½ ν’μ§**: λ…ΈνΈ λ‚΄μ©μ ν•µμ‹¬μ„ μ •ν™•ν λ°μν• μ”μ•½
5. **μµμ† κΈΈμ΄ κ²€μ¦**: λ„λ¬΄ μ§§μ€ λ…ΈνΈ(μ: 50μ λ―Έλ§)λ” μ”μ•½ μƒμ„± μ¤ν‚µ

## π”§ Dev Notes

### Tech Stack
- **ν”„λ μ„μ›ν¬**: Next.js 15.5.3 (App Router, Server Actions)
- **UI λΌμ΄λΈλ¬λ¦¬**: shadcn/ui + Tailwind CSS + Radix UI
- **λ°μ΄ν„°λ² μ΄μ¤**: Supabase Postgres
- **ORM**: Drizzle ORM 0.44.5
- **AI λ¨λΈ**: Google Gemini API (@google/genai 1.24.0)
- **λ¨λΈλ…**: gemini-2.0-flash-001
- **νΈμ¤ν…**: Vercel
- **κ°λ° λ„κµ¬**: TypeScript, ESLint, Drizzle Kit

### Previous Story Insights
- μ¤ν† λ¦¬ 4.1μ—μ„ Gemini API μ—°λ™ μ™„λ£ (`lib/ai/gemini.ts`)
- `regenerateAI` μ„λ²„ μ•΅μ… μ΄λ―Έ κµ¬ν„λ¨ (`lib/notes/actions.ts`)
- `summaries` ν…μ΄λΈ” μƒμ„± μ™„λ£ (noteId, model, content, createdAt)
- ν† ν° μ ν• κ΄€λ¦¬ (8k ν† ν°) μ΄λ―Έ κµ¬ν„λ¨

### Data Models
- **summaries ν…μ΄λΈ”**: 
  - id: UUID (κΈ°λ³Έν‚¤)
  - noteId: UUID (notes ν…μ΄λΈ” μ™Έλν‚¤, CASCADE DELETE)
  - model: text (κΈ°λ³Έκ°’: 'gemini-2.0-flash-001')
  - content: text (μ”μ•½ λ‚΄μ©)
  - createdAt: timestamp with timezone
  [Source: lib/db/schema/notes.ts]

- **notes ν…μ΄λΈ”**: 
  - id, userId, title, content, createdAt, updatedAt
  [Source: lib/db/schema/notes.ts]

### API Specifications
- **generateContent**: Gemini API νΈμ¶ ν•¨μ (`lib/ai/gemini.ts`)
- **createSummaryPrompt**: μ”μ•½ ν”„λ΅¬ν”„νΈ μƒμ„± ν•¨μ (`lib/ai/gemini.ts`)
- **regenerateAI**: AI μ”μ•½ λ° νƒκ·Έ μƒμ„± μ„λ²„ μ•΅μ… (μ΄λ―Έ κµ¬ν„λ¨, `lib/notes/actions.ts`)
- **ν† ν° μ ν•**: 8k ν† ν° (μ•½ 32,000μ)

### Component Specifications
- λ…ΈνΈ μ €μ¥ μ‹ μλ™μΌλ΅ AI μ”μ•½ μƒμ„±
- λ…ΈνΈ μƒμ„Έ νμ΄μ§€μ—μ„ μ”μ•½ ν‘μ‹ ν•„μ”
- μ”μ•½ μƒμ„± μ¤‘ λ΅λ”© μƒνƒ ν‘μ‹ ν•„μ”
- μ”μ•½ μ„Ήμ… UI μ»΄ν¬λ„νΈ μ‹ κ· μƒμ„±

### File Locations
- **μ„λ²„ μ•΅μ…**: `lib/notes/actions.ts` (κΈ°μ΅΄ νμΌ ν™•μ¥)
- **λ…ΈνΈ μƒμ„Έ νμ΄μ§€**: `app/notes/[id]/page.tsx` (κΈ°μ΅΄ νμΌ μμ •)
- **μ”μ•½ ν‘μ‹ μ»΄ν¬λ„νΈ**: `components/notes/note-summary.tsx` (μ‹ κ· μƒμ„±)
- **μΏΌλ¦¬ ν•¨μ**: `lib/notes/queries.ts` (κΈ°μ΅΄ νμΌ ν™•μ¥)

### Testing Requirements
- λ‹¤μ–‘ν• κΈΈμ΄μ λ…ΈνΈμ— λ€ν• μ”μ•½ μƒμ„± ν…μ¤νΈ
- μ§§μ€ λ…ΈνΈ(50μ λ―Έλ§)λ” μ”μ•½ μƒμ„± μ¤ν‚µ κ²€μ¦
- μ”μ•½ ν’μ§ κ²€μ¦ (3-6κ° λ¶λ¦Ώ ν¬μΈνΈ)
- λ°μ΄ν„°λ² μ΄μ¤ μ €μ¥ κ²€μ¦
- UI ν‘μ‹ κ²€μ¦

### Technical Constraints
- **λ³΄μ•**: μ„λ²„μ‚¬μ΄λ“μ—μ„λ§ AI API νΈμ¶
- **μ„±λ¥**: μ”μ•½ μƒμ„± μ‹κ°„ 10μ΄ μ΄λ‚΄ λ©ν‘
- **μ‚¬μ©μ κ²½ν—**: μ”μ•½ μƒμ„± μ¤‘ λ΅λ”© μƒνƒ ν‘μ‹
- **μ—λ¬ μ²λ¦¬**: μ”μ•½ μƒμ„± μ‹¤ν¨ μ‹ λ…ΈνΈλ” μ •μƒ μ €μ¥λμ–΄μ•Ό ν•¨

### Implementation Notes
- λ…ΈνΈ μ‘μ„±/μμ • μ™„λ£ ν›„ μλ™μΌλ΅ μ”μ•½ μƒμ„±
- κΈ°μ΅΄ `createNote`, `updateNote` μ•΅μ…μ— μ”μ•½ μƒμ„± λ΅μ§ μ¶”κ°€
- μ”μ•½ μƒμ„±μ€ λΉ„λ™κΈ°λ΅ μ²λ¦¬ν•μ—¬ μ‚¬μ©μ κ²½ν— μ €ν• λ°©μ§€
- μµμ† κΈΈμ΄ κ²€μ¦: contentκ°€ 50μ λ―Έλ§μ΄λ©΄ μ”μ•½ μƒμ„± μ¤ν‚µ

## π“ Tasks / Subtasks

### Task 1: λ…ΈνΈ μ €μ¥ μ‹ μλ™ μ”μ•½ μƒμ„± λ΅μ§ μ¶”κ°€ (AC: 1, 5)
- [x] `lib/notes/actions.ts`μ `createNote` ν•¨μμ— μ”μ•½ μƒμ„± λ΅μ§ μ¶”κ°€
- [x] `lib/notes/actions.ts`μ `updateNote` ν•¨μμ— μ”μ•½ μƒμ„± λ΅μ§ μ¶”κ°€
- [x] μµμ† κΈΈμ΄ κ²€μ¦ λ΅μ§ κµ¬ν„ (50μ λ―Έλ§ μ¤ν‚µ)
- [x] μ”μ•½ μƒμ„±μ„ try-catchλ΅ κ°μ‹Έμ„ μ‹¤ν¨ μ‹μ—λ„ λ…ΈνΈλ” μ €μ¥λλ„λ΅ μ²λ¦¬

### Task 2: μ”μ•½ μ΅°ν ν•¨μ κµ¬ν„ (AC: 2)
- [x] `lib/notes/queries.ts`μ— λ…ΈνΈλ³„ μ”μ•½ μ΅°ν ν•¨μ μ¶”κ°€
- [x] λ…ΈνΈ μƒμ„Έ μ΅°ν μ‹ μ”μ•½λ„ ν•¨κ» λ°ν™ν•λ„λ΅ μμ •
- [x] μ”μ•½μ΄ μ—†λ” κ²½μ° μ²λ¦¬ λ΅μ§ μ¶”κ°€

### Task 3: μ”μ•½ ν‘μ‹ UI μ»΄ν¬λ„νΈ μƒμ„± (AC: 3)
- [x] `components/notes/note-summary.tsx` μ»΄ν¬λ„νΈ μƒμ„±
- [x] μ”μ•½ λ‚΄μ©μ„ λ¶λ¦Ώ ν¬μΈνΈ ν•μ‹μΌλ΅ ν‘μ‹
- [x] μ”μ•½μ΄ μ—†λ” κ²½μ° ν‘μ‹ν•  λ©”μ‹μ§€ λλ” μ¨κΉ€ μ²λ¦¬
- [x] μ”μ•½ μƒμ„± λ‚ μ§ ν‘μ‹

### Task 4: λ…ΈνΈ μƒμ„Έ νμ΄μ§€μ— μ”μ•½ ν‘μ‹ (AC: 3)
- [x] `app/notes/[id]/page.tsx`μ— μ”μ•½ μ„Ήμ… μ¶”κ°€
- [x] `note-summary` μ»΄ν¬λ„νΈ μ—°λ™
- [x] μ”μ•½κ³Ό λ³Έλ¬Έ κµ¬λ¶„μ„ μ„ν• λ μ΄μ•„μ›ƒ μ΅°μ •

### Task 5: λ΅λ”© μƒνƒ λ° μ—λ¬ μ²λ¦¬
- [x] μ”μ•½ μƒμ„± μ¤‘ λ΅λ”© μΈλ””μΌ€μ΄ν„° ν‘μ‹
- [x] μ”μ•½ μƒμ„± μ‹¤ν¨ μ‹ μ—λ¬ λ©”μ‹μ§€ ν‘μ‹
- [x] μ¬μ‹λ„ λ΅μ§ κµ¬ν„ (μµμ…)

### Task 6: λ‹¨μ„ ν…μ¤νΈ μ‘μ„±
- [ ] λ‹¤μ–‘ν• κΈΈμ΄μ ν…μ¤νΈμ— λ€ν• μ”μ•½ μƒμ„± ν…μ¤νΈ
- [ ] μµμ† κΈΈμ΄ κ²€μ¦ ν…μ¤νΈ
- [ ] μ”μ•½ μ €μ¥ λ° μ΅°ν ν…μ¤νΈ
- [ ] UI μ»΄ν¬λ„νΈ λ λ”λ§ ν…μ¤νΈ

## π§ Testing Strategy

- **λ‹¨μ„ ν…μ¤νΈ**: μ”μ•½ μƒμ„± λ΅μ§, μµμ† κΈΈμ΄ κ²€μ¦
- **ν†µν•© ν…μ¤νΈ**: λ…ΈνΈ μ €μ¥ β†’ μ”μ•½ μƒμ„± β†’ μ €μ¥ β†’ μ΅°ν μ „μ²΄ ν”λ΅μ°
- **UI ν…μ¤νΈ**: μ”μ•½ ν‘μ‹ μ»΄ν¬λ„νΈ λ λ”λ§
- **μ„±λ¥ ν…μ¤νΈ**: λ‹¤μ–‘ν• κΈΈμ΄μ λ…ΈνΈμ— λ€ν• μ”μ•½ μƒμ„± μ‹κ°„ μΈ΅μ •
- **μ—λ¬ μ‹λ‚λ¦¬μ¤**: AI API μ‹¤ν¨, λ„¤νΈμ›ν¬ μ¤λ¥ λ“±

## π“ File List

- `lib/notes/actions.ts` (μμ •) - μλ™ μ”μ•½ μƒμ„± λ΅μ§ μ¶”κ°€
- `lib/notes/queries.ts` (μμ •) - μ”μ•½ μ΅°ν ν•¨μ μ¶”κ°€
- `components/notes/note-summary.tsx` (μ‹ κ·) - μ”μ•½ ν‘μ‹ μ»΄ν¬λ„νΈ
- `components/notes/summary-loading.tsx` (μ‹ κ·) - λ΅λ”© μƒνƒ μ»΄ν¬λ„νΈ
- `components/notes/summary-error.tsx` (μ‹ κ·) - μ—λ¬ μƒνƒ μ»΄ν¬λ„νΈ
- `app/notes/[id]/page.tsx` (μμ •) - μ”μ•½ ν‘μ‹ ν†µν•©

## π”— Dependencies

- Story 4.1: Gemini API μ„¤μ • λ° μ—°λ™ (ν•„μ μ™„λ£)
- Epic 2: λ…ΈνΈ κ΄€λ¦¬ μ‹μ¤ν… (λ…ΈνΈ CRUD κΈ°λ¥)

## π“ Definition of Done

- [ ] λ¨λ“  Tasksμ™€ Subtasks μ™„λ£
- [ ] λ‹¨μ„ ν…μ¤νΈ ν†µκ³Ό
- [ ] λ…ΈνΈ μ €μ¥ μ‹ μλ™ μ”μ•½ μƒμ„± λ™μ‘ ν™•μΈ
- [ ] μ”μ•½μ΄ λ°μ΄ν„°λ² μ΄μ¤μ— μ •μƒ μ €μ¥ ν™•μΈ
- [ ] λ…ΈνΈ μƒμ„Έ νμ΄μ§€μ—μ„ μ”μ•½ ν‘μ‹ ν™•μΈ
- [ ] μµμ† κΈΈμ΄ κ²€μ¦ λ™μ‘ ν™•μΈ
- [ ] μ—λ¬ μ²λ¦¬ κ²€μ¦ μ™„λ£
- [ ] μ½”λ“ λ¦¬λ·° μ™„λ£
- [ ] λ¬Έμ„ μ—…λ°μ΄νΈ μ™„λ£

## π“ Dev Agent Record

### Agent Model Used
- Claude Sonnet 4

### Debug Log References
- μλ™ μ”μ•½ μƒμ„± λ΅μ§μ΄ `createNote`μ™€ `updateNote` ν•¨μμ— μ„±κ³µμ μΌλ΅ ν†µν•©λ¨
- μµμ† κΈΈμ΄ κ²€μ¦ (50μ) λ΅μ§μ΄ μ •μƒ μ‘λ™ν•μ—¬ μ§§μ€ λ…ΈνΈλ” μ”μ•½ μƒμ„± μ¤ν‚µ
- μ”μ•½ μ΅°ν ν•¨μ `getNoteSummary`μ™€ `getNoteWithSummary` κµ¬ν„ μ™„λ£
- UI μ»΄ν¬λ„νΈλ“¤μ΄ μ •μƒμ μΌλ΅ λ λ”λ§λκ³  λ¶λ¦Ώ ν¬μΈνΈ νμ‹± μ‘λ™

### Completion Notes
- β… λ¨λ“  AC (Acceptance Criteria) μ¶©μ΅±
- β… λ…ΈνΈ μ €μ¥ μ‹ μλ™ μ”μ•½ μƒμ„± κΈ°λ¥ κµ¬ν„ μ™„λ£
- β… μ”μ•½ ν‘μ‹ UI μ»΄ν¬λ„νΈ κµ¬ν„ μ™„λ£
- β… λ΅λ”© λ° μ—λ¬ μƒνƒ μ²λ¦¬ κµ¬ν„ μ™„λ£
- β… μµμ† κΈΈμ΄ κ²€μ¦ λ΅μ§ κµ¬ν„ μ™„λ£
- β… μ—λ¬ λ°μƒ μ‹μ—λ„ λ…ΈνΈ μ €μ¥μ€ μ •μƒ μ‘λ™

### Change Log
- `lib/notes/actions.ts`: `generateAutoSummary` ν—¬νΌ ν•¨μ μ¶”κ°€, `createNote`/`updateNote`μ— μλ™ μ”μ•½ μƒμ„± λ΅μ§ ν†µν•©
- `lib/notes/queries.ts`: `getNoteSummary`, `getNoteWithSummary` ν•¨μ μ¶”κ°€
- `components/notes/note-summary.tsx`: μ”μ•½ ν‘μ‹ μ»΄ν¬λ„νΈ μ‹ κ· μƒμ„±
- `components/notes/summary-loading.tsx`: λ΅λ”© μƒνƒ μ»΄ν¬λ„νΈ μ‹ κ· μƒμ„±
- `components/notes/summary-error.tsx`: μ—λ¬ μƒνƒ μ»΄ν¬λ„νΈ μ‹ κ· μƒμ„±
- `app/notes/[id]/page.tsx`: μ”μ•½ ν‘μ‹λ¥Ό μ„ν• λ μ΄μ•„μ›ƒ μμ •

## π€ Ready for Development

μ΄ μ¤ν† λ¦¬λ” λ…ΈνΈ λ‚΄μ© κΈ°λ° μλ™ μ”μ•½ μƒμ„± κΈ°λ¥μ„ κµ¬ν„ν•©λ‹λ‹¤. Story 4.1μ—μ„ κµ¬μ¶•ν• Gemini API μΈν”„λΌλ¥Ό ν™μ©ν•μ—¬ μ‚¬μ©μκ°€ λ…ΈνΈλ¥Ό μ €μ¥ν•  λ• μλ™μΌλ΅ ν•µμ‹¬ λ‚΄μ©μ„ μ”μ•½ν•λ” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. λ¨λ“  κΈ°μ μ  μ”κµ¬μ‚¬ν•­κ³Ό μ μ•½μ‚¬ν•­μ΄ λ…ν™•ν μ •μλμ–΄ μμ–΄ κ°λ°μκ°€ μ¦‰μ‹ κµ¬ν„μ„ μ‹μ‘ν•  μ μμµλ‹λ‹¤.
