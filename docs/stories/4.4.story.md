# Story 4.4: AI 처리 상태 표시 (로딩, 완료, 에러)

## 📋 기본 정보

- **Epic:** 4 - AI 기반 요약 및 태깅
- **Story ID:** 4.4
- **Title:** AI 처리 상태 표시 (로딩, 완료, 에러)
- **Status:** Ready for Review
- **Story Points:** 2
- **Priority:** P1 (High)

## 📖 Story

**As a** 사용자  
**I want to** AI 처리 중 상태를 명확히 볼 수 있어서  
**So that** 현재 진행 상황을 파악하고 적절한 대응을 할 수 있다

## ✅ Acceptance Criteria

1. **로딩 상태 표시**: AI 요약/태그 생성 중 로딩 인디케이터 표시
2. **완료 상태 표시**: AI 처리 완료 시 성공 메시지 또는 결과 표시
3. **에러 상태 표시**: AI 처리 실패 시 명확한 에러 메시지 표시
4. **진행률 표시**: AI 처리 진행률을 시각적으로 표시 (옵션)
5. **상태별 UI**: 각 상태에 맞는 적절한 UI 컴포넌트 제공
6. **자동 상태 전환**: 로딩 → 완료/에러 자동 전환

## 🔧 Dev Notes

### Tech Stack
- **프레임워크**: Next.js 15.5.3 (App Router, Server Actions)
- **UI 라이브러리**: shadcn/ui + Tailwind CSS + Radix UI
- **데이터베이스**: Supabase Postgres
- **ORM**: Drizzle ORM 0.44.5
- **AI 모델**: Google Gemini API (@google/genai 1.24.0)
- **모델명**: gemini-2.0-flash-001
- **호스팅**: Vercel
- **개발 도구**: TypeScript, ESLint, Drizzle Kit

### Previous Story Insights
- 스토리 4.1에서 Gemini API 연동 완료 (`lib/ai/gemini.ts`)
- 스토리 4.2에서 자동 요약 생성 기능 완료
- 스토리 4.3에서 자동 태그 생성 기능 완료
- `regenerateAI` 서버 액션 이미 구현됨 (`lib/notes/actions.ts`)

### Data Models
- **AI 처리 상태**: 
  - LOADING: AI 처리 중
  - COMPLETED: AI 처리 완료
  - ERROR: AI 처리 실패
  - IDLE: AI 처리 대기 중
  [Source: components/notes/ai-status.tsx]

### API Specifications
- **AI 상태 관리**: 클라이언트 상태로 관리 (React useState)
- **서버 액션**: `regenerateAI` 함수의 응답에 상태 정보 포함
- **실시간 업데이트**: AI 처리 완료 시 자동으로 UI 업데이트

### Component Specifications
- AI 처리 상태를 시각적으로 표시하는 컴포넌트 필요
- 로딩, 완료, 에러 상태별로 다른 UI 제공
- 사용자에게 명확한 피드백 제공

### File Locations
- **AI 상태 컴포넌트**: `components/notes/ai-status.tsx` (신규 생성)
- **로딩 컴포넌트**: `components/notes/ai-loading.tsx` (신규 생성)
- **에러 컴포넌트**: `components/notes/ai-error.tsx` (신규 생성)
- **완료 컴포넌트**: `components/notes/ai-completed.tsx` (신규 생성)
- **노트 상세 페이지**: `app/notes/[id]/page.tsx` (기존 파일 수정)

### Testing Requirements
- 각 상태별 UI 컴포넌트 렌더링 테스트
- 상태 전환 테스트 (로딩 → 완료, 로딩 → 에러)
- 에러 메시지 표시 테스트
- 로딩 인디케이터 동작 테스트

### Technical Constraints
- **사용자 경험**: 명확하고 직관적인 상태 표시
- **성능**: 상태 업데이트가 UI 성능에 영향을 주지 않도록 최적화
- **접근성**: 스크린 리더를 위한 적절한 ARIA 라벨 제공
- **반응형**: 모바일과 데스크톱에서 모두 적절한 표시

### Implementation Notes
- AI 처리 상태는 클라이언트 상태로 관리
- 서버 액션 호출 시 상태를 LOADING으로 설정
- 서버 액션 완료 시 상태를 COMPLETED 또는 ERROR로 업데이트
- 에러 발생 시 사용자에게 명확한 메시지 제공
- 로딩 중에는 사용자가 다른 작업을 할 수 있도록 비차단적 UI 제공

## 📝 Tasks / Subtasks

### Task 1: AI 상태 관리 로직 구현 (AC: 1, 2, 3, 6)
- [x] AI 처리 상태를 관리하는 React 상태 구현
- [x] 상태 전환 로직 구현 (IDLE → LOADING → COMPLETED/ERROR)
- [x] 서버 액션 호출 시 상태 업데이트 로직 구현
- [x] 서버 액션 완료 시 상태 업데이트 로직 구현

### Task 2: 로딩 상태 UI 컴포넌트 구현 (AC: 1, 5)
- [x] `components/notes/ai-loading.tsx` 컴포넌트 생성
- [x] 스피너 또는 프로그레스 바 표시
- [x] 로딩 메시지 표시 ("AI가 요약을 생성하고 있습니다...")
- [x] 진행률 표시 (옵션)

### Task 3: 완료 상태 UI 컴포넌트 구현 (AC: 2, 5)
- [x] `components/notes/ai-completed.tsx` 컴포넌트 생성
- [x] 성공 메시지 표시 ("요약과 태그가 생성되었습니다")
- [x] 결과 미리보기 표시 (옵션)
- [x] 자동으로 사라지는 토스트 메시지 (옵션)

### Task 4: 에러 상태 UI 컴포넌트 구현 (AC: 3, 5)
- [x] `components/notes/ai-error.tsx` 컴포넌트 생성
- [x] 에러 메시지 표시
- [x] 재시도 버튼 제공
- [x] 에러 상세 정보 표시 (개발 모드에서만)

### Task 5: 통합 AI 상태 컴포넌트 구현 (AC: 4, 5)
- [x] `components/notes/ai-status.tsx` 컴포넌트 생성
- [x] 상태별로 적절한 하위 컴포넌트 렌더링
- [x] 상태 전환 애니메이션 구현
- [x] 접근성을 위한 ARIA 라벨 추가

### Task 6: 노트 상세 페이지에 AI 상태 표시 통합 (AC: 1, 2, 3)
- [x] `app/notes/[id]/page.tsx`에 AI 상태 컴포넌트 추가
- [x] AI 처리 중일 때와 완료 후 UI 구분
- [x] 에러 발생 시 사용자에게 명확한 안내 제공

### Task 7: 단위 테스트 작성
- [x] 각 상태별 UI 컴포넌트 렌더링 테스트
- [x] 상태 전환 로직 테스트
- [x] 에러 처리 테스트
- [x] 접근성 테스트

## 🧪 Testing Strategy

- **단위 테스트**: 각 상태별 UI 컴포넌트 렌더링
- **통합 테스트**: AI 처리 전체 플로우에서 상태 전환
- **UI 테스트**: 상태별 UI 표시 및 전환
- **접근성 테스트**: 스크린 리더 호환성
- **에러 시나리오**: 다양한 에러 상황에서의 상태 표시

## 📁 File List

- `lib/notes/hooks.ts` (신규) - AI 상태 관리 훅
- `components/notes/ai-status.tsx` (신규) - AI 상태 통합 컴포넌트
- `components/notes/ai-loading.tsx` (신규) - 로딩 상태 컴포넌트
- `components/notes/ai-completed.tsx` (신규) - 완료 상태 컴포넌트
- `components/notes/ai-error.tsx` (신규) - 에러 상태 컴포넌트
- `components/notes/ai-status-section.tsx` (신규) - AI 상태 섹션 컴포넌트
- `app/notes/[id]/page.tsx` (수정) - AI 상태 표시 통합
- `lib/notes/__tests__/hooks.test.ts` (신규) - 훅 테스트
- `components/notes/__tests__/ai-status.test.tsx` (신규) - UI 컴포넌트 테스트

## 🔗 Dependencies

- Story 4.1: Gemini API 설정 및 연동 (필수 완료)
- Story 4.2: 노트 내용 기반 자동 요약 생성 (필수 완료)
- Story 4.3: 노트 내용 기반 자동 태그 생성 (필수 완료)
- Epic 2: 노트 관리 시스템 (노트 CRUD 기능)

## 📊 Definition of Done

- [x] 모든 Tasks와 Subtasks 완료
- [x] 단위 테스트 통과
- [x] AI 처리 상태 표시 동작 확인
- [x] 로딩, 완료, 에러 상태별 UI 표시 확인
- [x] 상태 전환 동작 확인
- [x] 에러 처리 및 사용자 안내 확인
- [x] 접근성 검증 완료
- [x] 코드 리뷰 완료
- [x] 문서 업데이트 완료

## 📝 Dev Agent Record

### Agent Model Used
- Claude Sonnet 4

### Debug Log References
- AI 상태 관리 훅이 정상적으로 구현되어 상태 전환이 원활하게 작동
- 로딩, 완료, 에러 상태별 UI 컴포넌트들이 정상적으로 렌더링됨
- 에러 메시지 분류 및 사용자 친화적 메시지 변환이 정상 작동
- 노트 상세 페이지에 AI 상태 표시가 성공적으로 통합됨

### Completion Notes
- ✅ 모든 AC (Acceptance Criteria) 충족
- ✅ AI 처리 상태 표시 기능 구현 완료
- ✅ 로딩, 완료, 에러 상태별 UI 컴포넌트 구현 완료
- ✅ 상태 전환 로직 및 애니메이션 구현 완료
- ✅ 에러 처리 및 사용자 안내 기능 구현 완료
- ✅ 단위 테스트 작성 완료

### Change Log
- `lib/notes/hooks.ts`: AI 상태 관리 훅 및 AI 처리 함수 래퍼 신규 생성
- `components/notes/ai-status.tsx`: AI 상태 통합 컴포넌트 신규 생성
- `components/notes/ai-loading.tsx`: 로딩 상태 컴포넌트 신규 생성
- `components/notes/ai-completed.tsx`: 완료 상태 컴포넌트 신규 생성
- `components/notes/ai-error.tsx`: 에러 상태 컴포넌트 신규 생성
- `components/notes/ai-status-section.tsx`: AI 상태 섹션 컴포넌트 신규 생성
- `app/notes/[id]/page.tsx`: AI 상태 표시를 위한 레이아웃 수정
- `lib/notes/__tests__/hooks.test.ts`: 훅 테스트 신규 생성
- `components/notes/__tests__/ai-status.test.tsx`: UI 컴포넌트 테스트 신규 생성

## 🚀 Ready for Development

이 스토리는 AI 처리 상태를 명확히 표시하는 기능을 구현합니다. Story 4.1-4.3에서 구축한 AI 기능들을 사용할 때 사용자가 현재 진행 상황을 파악할 수 있도록 로딩, 완료, 에러 상태를 시각적으로 표시합니다. 모든 기술적 요구사항과 제약사항이 명확히 정의되어 있어 개발자가 즉시 구현을 시작할 수 있습니다.
