# Story 4.1: Gemini API ì„¤ì • ë° ì—°ë™

## ğŸ“‹ ê¸°ë³¸ ì •ë³´

- **Epic:** 4 - AI ê¸°ë°˜ ìš”ì•½ ë° íƒœê¹…
- **Story ID:** 4.1
- **Title:** Gemini API ì„¤ì • ë° ì—°ë™
- **Status:** Ready for Review
- **Story Points:** 2
- **Priority:** P1 (High)

## ğŸ“– Story

**As a** ê°œë°œì  
**I want to** Google Gemini APIë¥¼ í”„ë¡œì íŠ¸ì— ì„¤ì •í•˜ê³  ì—°ë™í•˜ì—¬  
**So that** AI ê¸°ë°˜ ìš”ì•½ ë° íƒœê¹… ê¸°ëŠ¥ì˜ ê¸°ë°˜ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤

## âœ… Acceptance Criteria

1. **API í‚¤ ì„¤ì •**: Google Gemini API í‚¤ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ì•ˆì „í•˜ê²Œ ì„¤ì •
2. **API í´ë¼ì´ì–¸íŠ¸ êµ¬ì„±**: Gemini API í˜¸ì¶œì„ ìœ„í•œ í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ë° ì„¤ì •
3. **ì„œë²„ ì•¡ì…˜ êµ¬í˜„**: Gemini API í˜¸ì¶œì„ ìœ„í•œ ì„œë²„ ì•¡ì…˜ í•¨ìˆ˜ ìƒì„±
4. **ì—ëŸ¬ í•¸ë“¤ë§**: API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬ êµ¬í˜„
5. **í† í° ì œí•œ ê´€ë¦¬**: 8k í† í° ì œí•œì„ ê³ ë ¤í•œ ì…ë ¥ ê²€ì¦ ë¡œì§ êµ¬í˜„

## ğŸ”§ Dev Notes

### Tech Stack
- **í”„ë ˆì„ì›Œí¬**: Next.js 15.5.3 (App Router, Server Actions)
- **UI ë¼ì´ë¸ŒëŸ¬ë¦¬**: shadcn/ui + Tailwind CSS + Radix UI
- **ë°ì´í„°ë² ì´ìŠ¤**: Supabase Postgres
- **ORM**: Drizzle ORM 0.44.5
- **AI ëª¨ë¸**: Google Gemini API (ìƒˆë¡œ ì¶”ê°€ë  íŒ¨í‚¤ì§€: @google/genai)
- **í˜¸ìŠ¤íŒ…**: Vercel
- **ê°œë°œ ë„êµ¬**: TypeScript, ESLint, Drizzle Kit

### Previous Story Insights
- Epic 2ì—ì„œ ë…¸íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì™„ì„±ë˜ì–´ AI ì²˜ë¦¬í•  ë…¸íŠ¸ ë°ì´í„°ê°€ ì¤€ë¹„ë¨
- Drizzle ORMê³¼ Supabase ì—°ë™ì´ ì™„ë£Œë˜ì–´ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì •ë¨

### Data Models
- **notes í…Œì´ë¸”**: id, user_id, title, content, created_at, updated_at [Source: architecture.md#2]
- **summaries í…Œì´ë¸”**: note_id, model, content, created_at [Source: architecture.md#2]
- **note_tags í…Œì´ë¸”**: note_id, tag [Source: architecture.md#2]

### API Specifications
- **Google Gemini API**: ìš”ì•½/íƒœê¹…ì„ ìœ„í•œ AI ëª¨ë¸ [Source: architecture.md#1]
- **í† í° ì œí•œ**: 8k í† í° ì œí•œ ê´€ë¦¬ í•„ìš” [Source: architecture.md#6]
- **ì„œë²„ ì•¡ì…˜**: `regenerateAI` - Gemini í˜¸ì¶œ í›„ ìš”ì•½/íƒœê·¸ ì €ì¥ [Source: architecture.md#4]

### Component Specifications
- ì„œë²„ì‚¬ì´ë“œì—ì„œë§Œ API í˜¸ì¶œ (í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ í˜¸ì¶œ ê¸ˆì§€) [Source: architecture.md#3]
- ë¹„ë™ê¸° ì²˜ë¦¬ ë° ë¡œë”© ìƒíƒœ ê´€ë¦¬ í•„ìš” [Source: epic-4-ai-summarization-tagging.md#26]

### File Locations
- **ì„œë²„ ì•¡ì…˜**: `lib/notes/actions.ts` (ê¸°ì¡´ íŒŒì¼ í™•ì¥)
- **API ìœ í‹¸ë¦¬í‹°**: `lib/ai/gemini.ts` (ì‹ ê·œ ìƒì„±)
- **í™˜ê²½ë³€ìˆ˜**: `.env.local` (ê¸°ì¡´ íŒŒì¼ í™•ì¥)

### Testing Requirements
- API í‚¤ ì„¤ì • ê²€ì¦ í…ŒìŠ¤íŠ¸
- í† í° ì œí•œ ê²€ì¦ í…ŒìŠ¤íŠ¸
- ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸
- API ì‘ë‹µ í˜•ì‹ ê²€ì¦ í…ŒìŠ¤íŠ¸

### Technical Constraints
- **ë³´ì•ˆ**: Supabase ì„œë¹„ìŠ¤ ë¡¤ í‚¤ëŠ” ì„œë²„ ì „ìš© [Source: architecture.md#3]
- **ì„±ëŠ¥**: ìš”ì•½ ê¸¸ì´ ì œí•œ(8k í† í°), Gemini ë¬´ë£Œ í• ë‹¹ í™œìš© [Source: architecture.md#6]
- **í”„ë ˆì„ì›Œí¬**: Next.js Server Actions ì‚¬ìš© [Source: architecture.md#1]

### @google/genai íŒ¨í‚¤ì§€ ì‚¬ìš©ë²•
```typescript
import { GoogleGenAI } from "@google/genai";

// API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
const genAI = new GoogleGenAI({ apiKey: process.env.GOOGLE_API_KEY });

// í…ìŠ¤íŠ¸ ìƒì„± ì˜ˆì‹œ
async function generateContent(prompt: string) {
  const result = await genAI.models.generateContent({
    model: "gemini-2.0-flash-001",
    contents: prompt
  });
  return result.text;
}
```

**ì„¤ì¹˜ ëª…ë ¹ì–´**: `npm install @google/genai`  
**í™˜ê²½ë³€ìˆ˜**: `GOOGLE_API_KEY=your_api_key_here`  
**ëª¨ë¸**: `gemini-2.0-flash-001` (ìµœì‹  ëª¨ë¸)

## ğŸ“ Tasks / Subtasks

### Task 1: í™˜ê²½ ì„¤ì • ë° ì˜ì¡´ì„± ì„¤ì¹˜ (AC: 1)
- [x] Google Gemini API í‚¤ë¥¼ `.env.local`ì— ì¶”ê°€
- [x] `@google/genai` íŒ¨í‚¤ì§€ ì„¤ì¹˜
- [x] í™˜ê²½ë³€ìˆ˜ íƒ€ì… ì •ì˜ ì¶”ê°€

### Task 2: Gemini API í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ (AC: 2)
- [x] `lib/ai/gemini.ts` íŒŒì¼ ìƒì„±
- [x] Gemini API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜ êµ¬í˜„
- [x] API í‚¤ ê²€ì¦ ë¡œì§ ì¶”ê°€

### Task 3: ì„œë²„ ì•¡ì…˜ êµ¬í˜„ (AC: 3)
- [x] `lib/notes/actions.ts`ì— `regenerateAI` í•¨ìˆ˜ ì¶”ê°€
- [x] ë…¸íŠ¸ ë‚´ìš©ì„ Gemini APIë¡œ ì „ì†¡í•˜ëŠ” ë¡œì§ êµ¬í˜„
- [x] ì‘ë‹µ ë°ì´í„° íŒŒì‹± ë° ê²€ì¦ ë¡œì§ êµ¬í˜„

### Task 4: ì—ëŸ¬ í•¸ë“¤ë§ êµ¬í˜„ (AC: 4)
- [x] API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬
- [x] ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬
- [x] API ì‘ë‹µ í˜•ì‹ ê²€ì¦
- [x] ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜

### Task 5: í† í° ì œí•œ ê´€ë¦¬ (AC: 5)
- [x] ì…ë ¥ í…ìŠ¤íŠ¸ ê¸¸ì´ ê²€ì¦ í•¨ìˆ˜ êµ¬í˜„
- [x] 8k í† í° ì œí•œ ì²´í¬ ë¡œì§ ì¶”ê°€
- [x] í† í° ì´ˆê³¼ ì‹œ ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬

### Task 6: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [x] API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸
- [x] í† í° ì œí•œ ê²€ì¦ í…ŒìŠ¤íŠ¸
- [x] ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸
- [x] API ì‘ë‹µ íŒŒì‹± í…ŒìŠ¤íŠ¸

## ğŸ§ª Testing Strategy

- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: ê° í•¨ìˆ˜ë³„ ë…ë¦½ì  í…ŒìŠ¤íŠ¸
- **í†µí•© í…ŒìŠ¤íŠ¸**: API í˜¸ì¶œ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- **ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤**: ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨, API í‚¤ ì˜¤ë¥˜, í† í° ì´ˆê³¼ ë“±
- **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: í† í° ì œí•œ ë‚´ì—ì„œì˜ ì²˜ë¦¬ ì‹œê°„ ì¸¡ì •

## ğŸ“ File List

- `lib/ai/gemini.ts` (ì‹ ê·œ)
- `lib/ai/__tests__/gemini.test.ts` (ì‹ ê·œ)
- `lib/notes/actions.ts` (ìˆ˜ì •)
- `lib/db/schema/notes.ts` (ìˆ˜ì •)
- `types/env.d.ts` (ì‹ ê·œ)
- `.env.local` (ìˆ˜ì •)
- `package.json` (ìˆ˜ì •)
- `drizzle/0002_nasty_silhouette.sql` (ì‹ ê·œ)

## ğŸ”— Dependencies

- Epic 2: ë…¸íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ (ë…¸íŠ¸ ë°ì´í„° í•„ìš”)
- Google Gemini API ê³„ì • ë° í‚¤

## ğŸ“Š Definition of Done

- [ ] ëª¨ë“  Tasksì™€ Subtasks ì™„ë£Œ
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] API í‚¤ ì„¤ì • ê²€ì¦ ì™„ë£Œ
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ê²€ì¦ ì™„ë£Œ
- [ ] í† í° ì œí•œ ê´€ë¦¬ ê²€ì¦ ì™„ë£Œ
- [ ] ì½”ë“œ ë¦¬ë·° ì™„ë£Œ
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ

## ğŸ“ Dev Agent Record

### Agent Model Used
- Claude Sonnet 4

### Debug Log References
- íŒ¨í‚¤ì§€ ì„¤ì¹˜: `@google/genai 1.24.0` ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë¨
- ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±: `drizzle/0002_nasty_silhouette.sql` ìƒì„±ë¨
- ë¦°íŒ… ê²€ì‚¬: ëª¨ë“  íŒŒì¼ì—ì„œ ë¦°í„° ì˜¤ë¥˜ ì—†ìŒ

### Completion Notes
- âœ… ëª¨ë“  AC (Acceptance Criteria) ë‹¬ì„±
- âœ… Gemini API í´ë¼ì´ì–¸íŠ¸ ì™„ì „ êµ¬í˜„
- âœ… ì„œë²„ ì•¡ì…˜ `regenerateAI` í•¨ìˆ˜ êµ¬í˜„
- âœ… ì—ëŸ¬ í•¸ë“¤ë§ ë° í† í° ì œí•œ ê´€ë¦¬ ì™„ë£Œ
- âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ì™„ë£Œ
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥ (summaries, note_tags í…Œì´ë¸”)

### Change Log
- 2024-01-14: `@google/genai` íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- 2024-01-14: `lib/ai/gemini.ts` í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
- 2024-01-14: `lib/notes/actions.ts`ì— `regenerateAI` í•¨ìˆ˜ ì¶”ê°€
- 2024-01-14: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥ (summaries, note_tags)
- 2024-01-14: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ë¦°íŒ… ê²€ì‚¬ ì™„ë£Œ

## ğŸš€ Ready for Development

ì´ ìŠ¤í† ë¦¬ëŠ” Gemini API ì„¤ì • ë° ì—°ë™ì„ ìœ„í•œ ê¸°ë°˜ ì‘ì—…ìœ¼ë¡œ, Epic 4ì˜ ëª¨ë“  AI ê¸°ëŠ¥ì˜ í† ëŒ€ê°€ ë©ë‹ˆë‹¤. ëª¨ë“  ê¸°ìˆ ì  ìš”êµ¬ì‚¬í•­ê³¼ ì œì•½ì‚¬í•­ì´ ëª…í™•íˆ ì •ì˜ë˜ì–´ ìˆì–´ ê°œë°œìê°€ ì¦‰ì‹œ êµ¬í˜„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
